---
kind: pipeline
name: nixos-tests

steps:
- name: test
  image: mic92/scratch
  environment:
    NIX_REMOTE: daemon
    PATH: /nix/var/nix/profiles/system/sw/bin/
    SSL_CERT_FILE: /nix/var/nix/profiles/system/etc/ssl/certs/ca-bundle.crt
    PAGER: cat
    USER: root
  volumes:
    - name: socket
      path: /nix/var/nix/daemon-socket/socket
  volumes:
    - name: nixstore
      path: /nix
  volumes:
    - name: binsh
      path: /bin/sh
  commands:
  - nix-build -I nixpkgs=https://github.com/NixOS/nixpkgs-channels/archive/nixpkgs-unstable.tar.gz -A sops-install-secrets.tests
  - nix-build -I nixpkgs=https://github.com/NixOS/nixpkgs-channels/archive/nixos-20.03.tar.gz -A sops-install-secrets.tests
volumes:
- name: nixstore
  host:
    path: /nix
- name: binsh
  host:
    path: /bin/sh
---
kind: signature
hmac: da836527c09a1048942de3875e0f2c7289628609fe11fd84ea5a71ce020ef73a

...
